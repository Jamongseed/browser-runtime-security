{
  "schemaVersion": "ruleset-v1",
  "rulesetId": "default-v1",
  "name": "기본 룰셋 (데모/PoC용)",
  "description": "content.js에서 발생하는 이벤트(type/data)를 기준으로 ruleId/scoreDelta/severity를 정책(룰셋)으로 정의합니다.",
  "enabled": true,
  "updatedAt": "2025-01-05",

  "rules": [
    {
      "id": "SENSOR_READY",
      "enabled": true,
      "when": { "type": "SENSOR_READY" },
      "action": {
        "ruleId": "SENSOR_READY",
        "scoreDelta": 0,
        "severity": "LOW"
      }
    },
    {
      "id": "DYN_SCRIPT_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT_CROSS_SITE",
      "enabled": true,
      "when": {
        "type": "DYN_SCRIPT_INSERT",
        "equals": { "initiatorCrossSite": true, "crossSite": true }
      },
      "action": {
        "ruleId": "DYN_SCRIPT_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
        "scoreDelta": 40,
        "severity": "HIGH"
      }
    },
    {
      "id": "DYN_SCRIPT_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT_SAME_SITE",
      "enabled": true,
      "when": {
        "type": "DYN_SCRIPT_INSERT",
        "equals": { "initiatorCrossSite": true, "crossSite": false }
      },
      "action": {
        "ruleId": "DYN_SCRIPT_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
        "scoreDelta": 30,
        "severity": "MEDIUM"
      }
    },
    {
      "id": "HIDDEN_IFRAME_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
      "enabled": true,
      "when": {
        "type": "DYN_IFRAME_INSERT",
        "equals": { "hidden": true, "initiatorCrossSite": true }
      },
      "action": {
        "ruleId": "HIDDEN_IFRAME_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
        "scoreDelta": 90,
        "severity": "HIGH"
      }
    },
    {
      "id": "IFRAME_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
      "enabled": true,
      "when": {
        "type": "DYN_IFRAME_INSERT",
        "equals": { "hidden": false, "initiatorCrossSite": true }
      },
      "action": {
        "ruleId": "IFRAME_INSERT_INITIATED_BY_CROSS_SITE_SCRIPT",
        "scoreDelta": 60,
        "severity": "HIGH"
      }
    },

    {
      "id": "DYN_SCRIPT_INSERT_CROSS_SITE",
      "enabled": true,
      "when": {
        "type": "DYN_SCRIPT_INSERT",
        "equals": { "crossSite": true }
      },
      "action": {
        "ruleId": "DYN_SCRIPT_INSERT_CROSS_SITE",
        "scoreDelta": 20,
        "severity": "MEDIUM"
      }
    },
    {
      "id": "DYN_SCRIPT_INSERT_SAME_SITE",
      "enabled": true,
      "when": {
        "type": "DYN_SCRIPT_INSERT",
        "equals": { "crossSite": false }
      },
      "action": {
        "ruleId": "DYN_SCRIPT_INSERT_SAME_SITE",
        "scoreDelta": 5,
        "severity": "LOW"
      }
    },
    {
      "id": "SW_REGISTER_INITIATED_BY_CROSS_SITE_SCRIPT",
      "enabled": true,
      "when": {
        "type": "SW_REGISTER",
        "equals": { "initiatorCrossSite": true }
      },
      "action": {
        "ruleId": "SW_REGISTER_INITIATED_BY_CROSS_SITE_SCRIPT",
        "scoreDelta": 80,
        "severity": "HIGH"
      }
    },
    {
      "id": "SW_REGISTER",
      "enabled": true,
      "when": { "type": "SW_REGISTER" },
      "action": {
        "ruleId": "SW_REGISTER",
        "scoreDelta": 10,
        "severity": "LOW"
      }
    },
    {
      "id": "SW_REGISTRATIONS_PRESENT",
      "enabled": true,
      "when": { "type": "SW_REGISTRATIONS_PRESENT" },
      "action": {
        "ruleId": "SW_REGISTRATIONS_PRESENT",
        "scoreDelta": 5,
        "severity": "LOW"
      }
    },
    {
      "id": "SW_PERSISTENCE_ACTIVE",
      "enabled": true,
      "when": { "type": "SW_PERSISTENCE_ACTIVE" },
      "action": {
        "ruleId": "SW_PERSISTENCE_ACTIVE",
        "scoreDelta": 20,
        "severity": "MEDIUM"
      }
    },
    {
      "id": "POC_G_SW_CHAIN",
      "enabled": true,
      "when": { "type": "POC_G_SW_CHAIN" },
      "action": {
        "ruleId": "POC_G_SW_CHAIN_CONFIRMED",
        "scoreDelta": 90,
        "severity": "HIGH"
      }
    },
    {
      "id": "HIDDEN_IFRAME_INSERT",
      "enabled": true,
      "when": {
        "type": "DYN_IFRAME_INSERT",
        "equals": { "hidden": true }
      },
      "action": {
        "ruleId": "HIDDEN_IFRAME_INSERT",
        "scoreDelta": 35,
        "severity": "HIGH"
      }
    },
    {
      "id": "IFRAME_INSERT",
      "enabled": true,
      "when": {
        "type": "DYN_IFRAME_INSERT",
        "equals": { "hidden": false }
      },
      "action": {
        "ruleId": "IFRAME_INSERT",
        "scoreDelta": 10,
        "severity": "LOW"
      }
    },
    {
      "id": "FORM_SUBMIT_AFTER_PROTO_TAMPER_MISMATCH",
      "enabled": true,
      "when": {
        "type": "FORM_SUBMIT",
        "equals": { "mismatch": true, "protoTamperSeen": true }
      },
      "action": {
        "ruleId": "PHISHING_FORM_MISMATCH_AFTER_PROTO_TAMPER",
        "scoreDelta": 80,
        "severity": "HIGH"
      }
    },
    {
      "id": "FORM_SUBMIT_AFTER_PROTO_TAMPER_OK",
      "enabled": true,
      "when": {
        "type": "FORM_SUBMIT",
        "equals": { "mismatch": false, "protoTamperSeen": true }
      },
      "action": {
        "ruleId": "FORM_SUBMIT_AFTER_PROTO_TAMPER",
        "scoreDelta": 30,
        "severity": "MEDIUM"
      }
    },
    {
      "id": "PHISHING_FORM_MISMATCH",
      "enabled": true,
      "when": {
        "type": "FORM_SUBMIT",
        "equals": { "mismatch": true }
      },
      "action": {
        "ruleId": "PHISHING_FORM_MISMATCH",
        "scoreDelta": 50,
        "severity": "HIGH"
      }
    },
    {
      "id": "FORM_ACTION_MATCH",
      "enabled": true,
      "when": {
        "type": "FORM_SUBMIT",
        "equals": { "mismatch": false }
      },
      "action": {
        "ruleId": "FORM_ACTION_MATCH",
        "scoreDelta": 5,
        "severity": "LOW"
      }
    },
    {
      "id": "FORM_ACTION_PARSE_FAIL",
      "enabled": true,
      "when": {
        "type": "FORM_SUBMIT",
        "equals": { "parse": "fail" }
      },
      "action": {
        "ruleId": "FORM_ACTION_PARSE_FAIL",
        "scoreDelta": 10,
        "severity": "MEDIUM",
        "targetOrigin": "UNKNOWN"
      }
    },
    {
      "id": "OBFUSCATION_ATOB",
      "enabled": true,
      "when": { "type": "SUSP_ATOB_CALL" },
      "action": {
        "ruleId": "OBFUSCATION_ATOB",
        "scoreDelta": 10,
        "severity": "LOW"
      }
    },
    {
      "id": "DYNAMIC_CODE_EVAL",
      "enabled": true,
      "when": { "type": "SUSP_EVAL_CALL" },
      "action": {
        "ruleId": "DYNAMIC_CODE_EVAL",
        "scoreDelta": 25,
        "severity": "MEDIUM"
      }
    },
    {
      "id": "DYNAMIC_CODE_FUNCTION",
      "enabled": true,
      "when": { "type": "SUSP_FUNCTION_CONSTRUCTOR_CALL" },
      "action": {
        "ruleId": "DYNAMIC_CODE_FUNCTION",
        "scoreDelta": 25,
        "severity": "MEDIUM"
      }
    },

    {
      "id": "DOM_XSS_INJECTION",
      "enabled": true,
      "when": { "type": "SUSP_DOM_XSS" },
      "action": {
        "ruleId": "DOM_XSS_INJECTION",
        "scoreDelta": 40,
        "severity": "HIGH"
      }
    },
    {
      "id": "COOKIE_THEFT",
      "enabled": true,
      "when": { "type": "SENSITIVE_DATA_ACCESS" },
      "action": {
        "ruleId": "COOKIE_THEFT",
        "scoreDelta": 50,
        "severity": "HIGH"
      }
    },
    {
      "id": "NETWORK_LEAK",
      "enabled": true,
      "when": { "type": "SUSP_NETWORK_CALL" },
      "action": {
        "ruleId": "NETWORK_LEAK",
        "scoreDelta": 15,
        "severity": "LOW"
      }
    },
    {
      "id": "INVISIBLE_LAYER_INSERT_RULE",
      "enabled": true,
      "when": {
        "type": "INVISIBLE_LAYER_DETECTED",
        "equals": { "reason": "INSERT" }
      },
      "action": {
        "ruleId": "INVISIBLE_LAYER_INSERT",
        "severity": "MEDIUM",
        "scoreDelta": 25
      }
    },
    {
      "id": "INVISIBLE_LAYER_CLICK_RULE",
      "enabled": true,
      "when": {
        "type": "INVISIBLE_LAYER_DETECTED",
        "equals": { "reason": "POINTERDOWN" }
      },
      "action": {
        "ruleId": "INVISIBLE_LAYER_CLICK",
        "severity": "HIGH",
        "scoreDelta": 60
      }
    },
    {
      "id": "POC_C_THIRDPARTY_POSTMESSAGE_ARM",
      "enabled": true,
      "when": {
        "type": "THIRDPARTY_POSTMESSAGE_ARM",
        "equals": {
          "action": "ARM_FORM_SWAP"
        }
      },
      "action": {
        "ruleId": "THIRDPARTY_WIDGET_ARMED",
        "severity": "MEDIUM",
        "scoreDelta": 15,
        "targetOrigin": "http://localhost:4000"
      }
    },
    {
      "id": "FORM_SUBMIT_PROTOTYPE_TAMPER",
      "enabled": true,
      "when": {
        "type": "PROTO_TAMPER",
        "equals": { "prop": "submit" }
      },
      "action": {
        "ruleId": "FORM_SUBMIT_PROTOTYPE_TAMPER",
        "scoreDelta": 40,
        "severity": "HIGH"
      }
    },
    {
      "id": "FORM_REQUESTSUBMIT_PROTOTYPE_TAMPER",
      "enabled": true,
      "when": {
        "type": "PROTO_TAMPER",
        "equals": { "prop": "requestSubmit" }
      },
      "action": {
        "ruleId": "FORM_REQUESTSUBMIT_PROTOTYPE_TAMPER",
        "scoreDelta": 35,
        "severity": "HIGH"
      }
    }
  ]
}
