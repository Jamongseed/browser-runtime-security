[상황]
애초에 엉뚱한 목적지에 오게되는 상황을 가정하고 만들었습니다.
멀쩡한 링크를 눌렀지만, 다른곳으로 가게 되는 경우입니다.

1. 링크는 정상 상태
2. 사용자가 링크를 누를 때, pointerdown 순간에 캡쳐 발생
3. JS가 즉시 href를 '/ad'로 변경
4. 브라우저가 이어서 기본 동작 click을 마저 실행
5. '/ad'로 바뀐곳으로 이동

이전에 poc-c에서 구현한 것이, 서드파티 스크립트가 관여해서 원래 사이트의 멀쩡한 동작을 이상하게 바꿔놓는 식으로 예약을 해둔 방식이라면,
이번에는 정말 말 그대로 클릭하는 순간에 바꿔치기하는 '즉시형 공격'을 구현하고 싶었습니다.
클릭 이전에는 그냥 정상적인 주소로 안내하는 href 버튼입니다. 클릭 순간에 목적지가 바뀌기 때문에 좀 악질 입니다.

웹API랑 함수를 공부하면서 PR comment를 받다가, click 말고도 pointerdown이라는 타이밍까지도 함수가 존재하는게 신기해서 이걸로 뭔가를 만들어보고 싶었습니다.

'서버,HTML,href링크'는 정상적이지만, 오로지 브라우저 런타임에서만 진실이 바뀌기에 확장프로그램이 유용한 상황이라고 생각했습니다.

[탐지요소]
1. MutationObserver로 href attribute 변경 잡기
2. pointerdown 이후 짧은 시간 동안 requestAnimationFrame/setTimeout로 a.href 재확인
3. pointerdown 같은 클릭시점기록을 이벤트 캡쳐로 잡아서 값이 바뀐걸 확인
4. beforeunload/pagehide로 navigation이 일어났는지 확인해보기?

요정도로 추측해 볼 수 있습니다.


[GPT 가라사대(요약)]
본 PoC는 사용자가 링크를 클릭하는 순간(pointerdown)에만
링크 목적지(href)를 변조하는 “Just-In-Time 링크 하이재킹”을 시연한다.
변조는 수 ms 내에 발생하며, 일반 사용자는 인지할 수 없다.
이 행위는 서버/WAF에서 관측이 불가능하고,
오직 브라우저 런타임에서만 탐지가 가능하다.